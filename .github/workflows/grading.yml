name: Autograding - Fruit Info

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  autograde:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout student repo
        uses: actions/checkout@v4

      - name: Install build tools
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential

      - name: Build main.c
        run: |
          gcc -Wall -Wextra -std=c11 -o main main.c

      - name: Run student program
        run: |
          ./main

      - name: Prepare expected fruit_info.txt
        run: |
          cat > expected_fruit_info.txt << 'EOF'
offset: 2
name: Melon
color: Green
price: 32000
EOF

      - name: Check fruit_info.txt exists
        run: |
          if [ ! -f fruit_info.txt ]; then
            echo "fruit_info.txt 파일이 생성되지 않았습니다."
            exit 1
          fi

      - name: Compare output with expected
        run: |
          diff -u expected_fruit_info.txt fruit_info.txt

      - name: Report success
        if: ${{ success() }}
        run: |
          echo "✅ fruit_info.txt 내용이 정답과 일치합니다."
